     1                                  extern ToRealNumber
     2                                  extern stdout
     3                                  extern OutNumber
     4                                  %include "printmacros.mac"
     1                              <1> extern  fprintf
     2                              <1> extern  OutContainer
     3                              <1> 
     4                              <1> ;-------------------------------------------------------------
     5                              <1> ; Вывод строки, передаваемой непосредственно макросу
     6                              <1> ; с переводом на следующую строку
     7                              <1> %macro  PrintStr2    2
     8                              <1>     section .data
     9                              <1>         %%arg1  db  %1,10,0     ; first argument
    10                              <1>     section .text               ; the printf arguments
    11                              <1>         mov rdi, %2
    12                              <1>         mov rsi, %%arg1
    13                              <1>         mov rax, 0              ; no floating point
    14                              <1>         call fprintf
    15                              <1> %endmacro
    16                              <1> 
    17                              <1> ; Вывод содержимого контейнера
    18                              <1> %macro  PrintContainer2    3
    19                              <1>     mov     rdi, %1
    20                              <1>     mov     esi, %2
    21                              <1>     mov     rdx, %3
    22                              <1>     mov     rax, 0              ; нет чисел с плавающей точкой
    23                              <1>     call    OutContainer
    24                              <1> %endmacro
    25                              <1> 
    26                              <1> %macro  PrintInt2    2
    27                              <1>     section .data
    28                              <1>         %%arg1  db  "%d ",10,0     ; first argument
    29                              <1>     section .text               ; the printf arguments
    30                              <1>         mov rdi, %2
    31                              <1>         mov rsi, %%arg1
    32                              <1>         mov rdx, %1
    33                              <1>         mov rax, 0              ; no floating point
    34                              <1>         call fprintf
    35                              <1> %endmacro
    36                              <1> 
    37                              <1> %macro  PrintDouble2    2
    38                              <1>     section .data
    39                              <1>         %%arg1  db  "%g",0     ; first argument
    40                              <1>     section .text               ; the printf arguments
    41                              <1>         mov rdi, %2
    42                              <1>         mov rsi, %%arg1
    43                              <1>         movsd xmm0, %1
    44                              <1>         mov rax, 1              ; no floating point
    45                              <1>         call fprintf
    46                              <1> %endmacro
     5                                  
     6                                  global BubbleSortContainer
     7                                  BubbleSortContainer:
     8                                  section .data
     9 00000000 25643A2000                  numFmt  db  "%d: ",0
    10                                  section .bss
    11 00000000 <res 00000008>              .pcont  resq    1   ; адрес контейнера
    12 00000008 <res 00000004>              .len    resd    1   ; адрес для сохранения числа введенных элементов
    13 0000000C <res 00000008>              .FILE   resq    1   ; указатель на файл
    14                                  section .text
    15 00000000 55                      push rbp
    16 00000001 4889E5                  mov rbp, rsp
    17                                  
    18 00000004 48893C25[00000000]          mov [.pcont], rdi   ; сохраняется указатель на контейнер
    19                                      ; PrintInt2 [.pcont], [.FILE]
    20                                      ; mov eax, [rdi]
    21 0000000C 893425[08000000]            mov [.len],   esi     ; сохраняется число элементов
    22 00000013 48891425[0C000000]          mov [.FILE],  rdx    ; сохраняется указатель на файл
    23                                  
    24                                      ; В rdi адрес начала контейнера
    25 0000001B 4889F3                      mov rbx, rsi            ; число фигур
    26 0000001E 31C9                        xor ecx, ecx            ; счетчик фигур = 0
    27 00000020 4889D6                      mov rsi, rdx            ; перенос указателя на файл
    28                                  .loop:
    29 00000023 39D9                        cmp ecx, ebx            ; проверка на окончание цикла
    30 00000025 7D5B                        jge .return             ; Перебрали все фигуры
    31                                  
    32 00000027 53                          push rbx
    33 00000028 51                          push rcx
    34                                  
    35                                      ; Вывод номера фигуры
    36 00000029 488B3C25[0C000000]          mov     rdi, [.FILE]    ; текущий указатель на файл
    37 00000031 48BE-                       mov     rsi, numFmt     ; формат для вывода фигуры
    37 00000033 [0000000000000000] 
    38 0000003B 89CA                        mov     edx, ecx        ; индекс текущей фигуры
    39 0000003D 4831C0                      xor     rax, rax,       ; только целочисленные регистры
    40 00000040 E8(00000000)                call fprintf
    41                                  
    42                                      ; Вывод текущей фигуры
    43 00000045 488B3C25[00000000]          mov     rdi, [.pcont]
    44 0000004D 488B3425[0C000000]          mov     rsi, [.FILE]
    45                                      call    ToRealCoordinates
    45          ******************       error: symbol `ToRealCoordinates' undefined
    46                                      movsd   [.p], xmm0          ; сохранение (может лишнее) периметра
    46          ******************       error: symbol `numFmt.p' undefined
    47 00000055 E8(00000000)                call OutNumber     ; Получение периметра первой фигуры
    48                                  
    49 0000005A 59                          pop rcx
    50 0000005B 5B                          pop rbx
    51 0000005C FFC1                        inc ecx                 ; индекс следующей фигуры
    52                                  
    53 0000005E 488B0425[00000000]          mov     rax, [.pcont]
    54 00000066 4883C010                    add     rax, 16         ; адрес следующей фигуры
    55 0000006A 48890425[00000000]          mov     [.pcont], rax
    56 00000072 EBAF                        jmp .loop
    57                                  .return:
    57          ******************       error: label `numFmt.return' changed during code generation [-w+error=label-redef-late]
    58 00000074 C9                      leave
    59 00000075 C3                      ret
